---
title: "La lotteria nazionale non è difettosa"
author: "[Tommaso Rigon]{.orange}"
lang: it
date: 2025-03-08
format:
  html:
    html-math-method: katex
    echo: false
    callout-appearance: minimal
    toc: true
    embed-resources: false
    code-line-numbers: true
    smooth-scroll: true
    fig-dpi: 250
    toc-location: left
editor: 
  markdown: 
    wrap: 72
editor_options: 
  chunk_output_type: console
---

## Un'analisi delle estrazioni della lotteria nazionale

Dopo la pubblicazione di un mio [post di qualche giorno fa](index.qmd) riguardante la lotteria nazionale, alcuni commentatori social (si, forse dovrei smettere di leggerli) hanno messo in discussione la validità delle ipotesi su cui si regge le lotteria, ed in particolare l'[equiprobabilità]{.blue} dei numeri del lotto. In altri termini, secondo loro, alcuni numeri avrebbero maggiore probabilità di essere estratti rispetto ad altri.

Se ciò fosse vero, significherebbe che i dipendenti della lotteria hanno per anni commesso un [grave errore]{.orange}, fatto che probabilmente avrebbero ripercussioni legali importanti. In buona sostanza, l'ipotesi alternativa di alcuni commentatori è che il macchinario con cui vengono estratti i numeri sia "difettoso" e che questo favorisca alcuni numeri rispetto ad altri.

Sebbene l'[onere della prova]{.blue} dovrebbe spettare a chi muove questa accusa, ho deciso ugualmente di prendere le parti della difesa e di analizzare i dati a disposizione. 

Dopo aver studiato i dati della lotteria nazionale degli ultimi 20 anni, [non ho registrato alcun tipo di anomalia statistica]{.orange}. In altri termini, non c'è evidenza di alcun macchinario difettoso. 

## I dati della lotteria nazionale

I dati delle estrazioni del Lotto sono a disposizione sul [sito ufficiale del Lotto](https://www.lotto-italia.it/lotto/estratti-ruote) a partire dalle estrazioni del 1939. La [lotteria nazionale]{.blue} inizia invece dal [5 Maggio 2005]{.blue}, cioè la data della prima estrazione nazionale. Questa analisi è replicabile da chiunque avesse interesse a farlo. 

Per dare un po' di contesto, i 3 studenti dell'Università del Salento hanno scommesso sui numeri 21 e 48 della lotteria nazionale in data 1 Marzo 2025, vincendo, come si può vedere nella fotografia allegata.

![Immagine tratta dall'articolo originale di [Repubblica](https://bari.repubblica.it/cronaca/2025/03/05/news/vinti_50mila_euro_al_lotto_grazie_all_intelligenza_artificiale_il_sistema_di_3_studenti_di_fisica-424043596/).](biglietti.jpg){width=5in}

A titolo di esempio, le ultime tre estrazioni sono state:

```{r}
rm(list = ls())
lotteria <- read.table("storico.txt", header = FALSE, na.strings = "NAA")
colnames(lotteria) <- c("Data", "Provincia", "N1", "N2", "N3", "N4", "N5")
lotteria$Data <- as.Date(lotteria$Data)

# Seleziono lotteria nazionale (Codice RN)
lot_naz <- lotteria[lotteria$Provincia == "RN", ]

knitr::kable(tail(lot_naz[, -2], 3), row.names = F)
```

A detta stessa dei 3 studenti e di alcuni commentatori dei social, ci sarebbero delle anomalie nelle frequenze dei numeri del lotto. Ho calcolato le frequenze di ciascun numero, per verificare questa affermazione e non ho riscontrato anomalie. Per semplicità, qui di seguito riporto le frequenze del primo numero estratto (`N1`). 

:::{.small}
```{r}
freq <- c(table(lot_naz$N1))
names(freq) <- 1:90
knitr::kable(t(freq[1:15]))
knitr::kable(t(freq[16:30]))
knitr::kable(t(freq[31:45]))
knitr::kable(t(freq[46:60]))
knitr::kable(t(freq[61:75]))
knitr::kable(t(freq[76:90]))
```
:::

In totale sono state effettuate $n$ = `r sum(freq)` estrazioni. Ad un occhio poco esperto, potrebbe sembrare che i numeri 15 ed 80 compaiano con maggiore frequenza rispetto agli altri (51 volte e 50 volte, rispettivamente). È anche ironico notare che non si tratta dei numeri (21 e 48) usati nella famosa scommessa -- non saprei proprio dire quale criterio abbiano seguito i tre studenti salentini. In ogni caso, si tratta di [oscillazioni casuali]{.orange}, come vedremo. 

Possiamo anche rappresentare graficamente queste frequenze, ottenendo il seguente [diagramma a bastoncini](https://tommasorigon.github.io/StatI/slides/sl_G.pdf). 

```{r}
#| fig-width: 12
#| fig-height: 6
plot(table(lot_naz$N1), ylab = "Frequenza", xlab = "Primo numero estratto", main = "Lotteria nazionale")
```

::: callout-tip
La tabella ed il grafico confermano che ci sono delle oscillazioni nelle frequenze: alcuni numeri sono comparsi di più, altri di meno. Questo è un fenomeno assolutamente normale! 
:::

## Oscillazioni casuali o lotteria difettosa?

Per stabilire se le oscillazioni che abbiamo registrato sono frutto del caso o meno, dobbiamo usare degli [strumenti statistici]{.orange} un po' più complicati. Sotto l'ipotesi di indipendenza delle estrazioni, ma non quella di equidistribuzione, la frequenze che abbiano riportato sopra, che indichiamo con $n_1,\dots,n_{90}$, seguono una [distribuzione multinomiale]{.blue} di parametro $n$ = `r sum(freq)` e probabilità $p_1,\dots,p_{90}$. 

Vogliamo verificare se le probabilità $p_1,\dots,p_{90}$ sono diverse tra loro, cosa che indicherebbe la presenza di un macchinario "difettoso", oppure se sono uguali tra loro e pari a $1/90$. Per far questo, facciamo uso del celeberrimo [test del Chi-quadrato]{.orange}. In pratica, confrontiamo le frequenze che abbiamo osservato $n_1,\dots,n_{90}$ con quelle "teoriche", pari a $n_\text{teo} = n / 90 = 35.233$. Otteniamo:
$$
X^2 = \frac{(n_1 - n_\text{teo})^2 + \cdots + (n_{90} - n_\text{teo})^2}{n_\text{teo}} = 102.12. 
$$
Il numero $X^2$ = 102.12 va confrontato con i valori che ci aspetteremmo di osservare se la lotteria fosse regolare, che sono compresi tra circa `r round(qchisq(0.025, 89))` e `r round(qchisq(0.975, 89))`. Più rigorosamente, calcoliamo il cosiddetto [p-value]{.blue}, un concetto tecnico un po' difficile da raccontare, ma che in buona sostanza ci conferma che [non ci sono anomalie statistiche]{.orange}. Per gli statistici in ascolto, ecco i risultati completi:
```{r}
chisq.test(freq)
```

## Un cenno a metodi statistici più complessi

:::callout-warning
#### E gli altri numeri?
In effetti, i numeri della lotteria sono 5 mentre noi abbiamo analizzato soltanto il primo (`N1`). Ho pertanto eseguito la stessa analisi per tutti i numeri `N1`, `N2`, `N3`, `N4` ed `N5`, applicando una correzione di Bonferroni ai p-value, senza registrare alcuna anomalia. A dirla tutta, nessun p-value risultava inferiore a $0.1$ nemmeno prima della correzione di Bonferroni. 

Ancor meglio, si potrebbe modellare la distribuzione congiunta dei $5$ numeri della lotteria e confrontarla quindi con una distribuzione ipergeometrica multivariata. Questra strada è forse la migliore ed è anche tecnicamente percorribile, ma richiede un po' troppo lavoro aggiuntivo che mi sembrava eccessivo ai fini di questo post.
:::

:::callout-warning
#### E l'ipotesi di indipendenza?
In questa analisi abbiamo fatto uso dell'ipotesi di indipendenza tra le diverse estrazioni. È un'ipotesi molto ragionevole, perchè l'unico modo per violarla è tramite una [frode]{.blue}. 

In linea di principio, anche l'ipotesi di indipendenza può essere messa sotto attento scrutinio statistico, al costo di un po' di lavoro aggiuntivo. Mi sembra, però, che l'accusa di frode allo stato italiano sfoci nel [complottismo]{.blue}, soprattutto se non supportata da ulteriori prove indiziali di altra natura.
:::
