<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="it" xml:lang="it"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Tommaso Rigon">

<title>La lotteria nazionale non è difettosa – Tommaso Rigon</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "Nessun risultato",
    "search-matching-documents-text": "documenti trovati",
    "search-copy-link-title": "Copiare il link nella ricerca",
    "search-hide-matches-text": "Nascondere i risultati aggiuntivi",
    "search-more-match-text": "ci sono altri risultati in questo documento",
    "search-more-matches-text": "ulteriori risultati in questo documento",
    "search-clear-button-title": "Pulire",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancellare",
    "search-submit-button-title": "Inviare",
    "search-label": "Ricerca"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Attiva/disattiva la navigazione" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../papers.html"> 
<span class="menu-text">Papers</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../bio.html"> 
<span class="menu-text">Short Bio</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../teaching.html"> 
<span class="menu-text">Teaching &amp; Slides</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tesi.html"> 
<span class="menu-text">Thesis Information (ITA)</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../post.html"> 
<span class="menu-text">Blogpost</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">In questa pagina</h2>
   
  <ul>
  <li><a href="#unanalisi-delle-estrazioni-della-lotteria-nazionale" id="toc-unanalisi-delle-estrazioni-della-lotteria-nazionale" class="nav-link active" data-scroll-target="#unanalisi-delle-estrazioni-della-lotteria-nazionale">Un’analisi delle estrazioni della lotteria nazionale</a></li>
  <li><a href="#un-problema-storico" id="toc-un-problema-storico" class="nav-link" data-scroll-target="#un-problema-storico">Un problema storico</a></li>
  <li><a href="#i-dati-della-lotteria-nazionale" id="toc-i-dati-della-lotteria-nazionale" class="nav-link" data-scroll-target="#i-dati-della-lotteria-nazionale">I dati della lotteria nazionale</a></li>
  <li><a href="#oscillazioni-casuali-o-lotteria-difettosa" id="toc-oscillazioni-casuali-o-lotteria-difettosa" class="nav-link" data-scroll-target="#oscillazioni-casuali-o-lotteria-difettosa">Oscillazioni casuali o lotteria difettosa?</a></li>
  <li><a href="#un-cenno-a-metodi-statistici-più-complessi" id="toc-un-cenno-a-metodi-statistici-più-complessi" class="nav-link" data-scroll-target="#un-cenno-a-metodi-statistici-più-complessi">Un cenno a metodi statistici più complessi</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">La lotteria nazionale non è difettosa</h1>
</div>



<div class="quarto-title-meta column-page-left">

    <div>
    <div class="quarto-title-meta-heading">Autore/Autrice</div>
    <div class="quarto-title-meta-contents">
             <p><span class="orange">Tommaso Rigon</span> </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Data di Pubblicazione</div>
    <div class="quarto-title-meta-contents">
      <p class="date">8 marzo 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="unanalisi-delle-estrazioni-della-lotteria-nazionale" class="level2">
<h2 class="anchored" data-anchor-id="unanalisi-delle-estrazioni-della-lotteria-nazionale">Un’analisi delle estrazioni della lotteria nazionale</h2>
<p>Dopo la pubblicazione di un mio <a href="../../post/lotteria_AI/index.html">post di qualche giorno fa</a> riguardante la lotteria nazionale, alcuni commentatori social (si, forse dovrei smettere di leggerli) hanno messo in discussione la validità delle ipotesi su cui si regge le lotteria, ed in particolare l’<span class="blue">equiprobabilità</span> dei numeri del lotto. In altri termini, secondo loro, alcuni numeri avrebbero maggiore probabilità di essere estratti rispetto ad altri.</p>
<p>Se ciò fosse vero, significherebbe che i dipendenti della lotteria hanno per anni commesso un <span class="orange">grave errore</span>, fatto che probabilmente avrebbero ripercussioni legali importanti. In buona sostanza, l’ipotesi alternativa di alcuni commentatori è che il macchinario con cui vengono estratti i numeri sia “difettoso” e che questo favorisca alcuni numeri rispetto ad altri.</p>
<p>Sebbene l’<span class="blue">onere della prova</span> dovrebbe spettare a chi muove questa accusa, ho deciso ugualmente di prendere le parti della difesa e di analizzare i dati a disposizione.</p>
<p>Dopo aver studiato i dati della lotteria nazionale degli ultimi 20 anni, <span class="orange">non ho registrato alcun tipo di anomalia statistica</span>. In altri termini, non c’è evidenza di alcun macchinario difettoso.</p>
</section>
<section id="un-problema-storico" class="level2">
<h2 class="anchored" data-anchor-id="un-problema-storico">Un problema storico</h2>
<p>Il problema dell’equità di una lotteria ha una lunga e importante storia, che è elegantemente raccontata nell’articolo di <span class="blue">storia della statistica</span> di Stigler (2003)<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>:</p>
<ul>
<li>Stigler S. M. (2003), <a href="http://www.numdam.org/item/JSFS_2003__144_1-2_5_0.pdf">Casanova, «Bonaparte», and the loterie de France</a>, <em>Journal de la société française de statistique</em>, <strong>144</strong>(1-2), 5–34.</li>
</ul>
<p>Gli strumenti statistici che qui presenteremo sono simili a quelli usati da Stigler per analizzare la lotteria francese del 18esimo secolo. L’articolo di Stigler è molto <span class="blue">più completo e dettagliato</span> di questo post, e ne consiglio caldamente la lettura. Anzitutto, è una testimonianza importante di quanta intelligenza sia già stata dedicata alla questione della lotteria, oltre che esempio di come la statistica possa risolvere problemi concreti.</p>
</section>
<section id="i-dati-della-lotteria-nazionale" class="level2">
<h2 class="anchored" data-anchor-id="i-dati-della-lotteria-nazionale">I dati della lotteria nazionale</h2>
<p>I dati delle estrazioni del Lotto sono a disposizione sul <a href="https://www.lotto-italia.it/lotto/estratti-ruote">sito ufficiale del Lotto</a> a partire dalle estrazioni del 1939. La <span class="blue">lotteria nazionale</span> inizia invece dal <span class="blue">5 Maggio 2005</span>, cioè la data della prima estrazione nazionale. Questa analisi è replicabile da chiunque avesse interesse a farlo.</p>
<p>Per dare un po’ di contesto, i 3 studenti dell’Università del Salento hanno scommesso sui numeri 21 e 48 della lotteria nazionale in data 1 Marzo 2025, vincendo, come si può vedere nella fotografia allegata.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="biglietti.jpg" class="img-fluid figure-img" style="width:5in"></p>
<figcaption>Immagine tratta dall’articolo originale di <a href="https://bari.repubblica.it/cronaca/2025/03/05/news/vinti_50mila_euro_al_lotto_grazie_all_intelligenza_artificiale_il_sistema_di_3_studenti_di_fisica-424043596/">Repubblica</a>.</figcaption>
</figure>
</div>
<p>A titolo di esempio, le ultime cinque estrazioni sono state:</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Data</th>
<th style="text-align: right;">N1</th>
<th style="text-align: right;">N2</th>
<th style="text-align: right;">N3</th>
<th style="text-align: right;">N4</th>
<th style="text-align: right;">N5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2025-02-28</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="even">
<td style="text-align: left;">2025-03-01</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">62</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2025-03-04</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">40</td>
</tr>
<tr class="even">
<td style="text-align: left;">2025-03-06</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">83</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">14</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2025-03-07</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">88</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">28</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>A detta stessa dei 3 studenti e di alcuni commentatori dei social, ci sarebbero delle anomalie nelle frequenze dei numeri del lotto. Ho calcolato le frequenze di ciascun numero, per verificare questa affermazione e non ho riscontrato anomalie. Per semplicità, qui di seguito riporto le frequenze del primo numero estratto (<code>N1</code>).</p>
<div class="small">
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">1</th>
<th style="text-align: right;">2</th>
<th style="text-align: right;">3</th>
<th style="text-align: right;">4</th>
<th style="text-align: right;">5</th>
<th style="text-align: right;">6</th>
<th style="text-align: right;">7</th>
<th style="text-align: right;">8</th>
<th style="text-align: right;">9</th>
<th style="text-align: right;">10</th>
<th style="text-align: right;">11</th>
<th style="text-align: right;">12</th>
<th style="text-align: right;">13</th>
<th style="text-align: right;">14</th>
<th style="text-align: right;">15</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">25</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">51</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">16</th>
<th style="text-align: right;">17</th>
<th style="text-align: right;">18</th>
<th style="text-align: right;">19</th>
<th style="text-align: right;">20</th>
<th style="text-align: right;">21</th>
<th style="text-align: right;">22</th>
<th style="text-align: right;">23</th>
<th style="text-align: right;">24</th>
<th style="text-align: right;">25</th>
<th style="text-align: right;">26</th>
<th style="text-align: right;">27</th>
<th style="text-align: right;">28</th>
<th style="text-align: right;">29</th>
<th style="text-align: right;">30</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">41</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">31</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">31</th>
<th style="text-align: right;">32</th>
<th style="text-align: right;">33</th>
<th style="text-align: right;">34</th>
<th style="text-align: right;">35</th>
<th style="text-align: right;">36</th>
<th style="text-align: right;">37</th>
<th style="text-align: right;">38</th>
<th style="text-align: right;">39</th>
<th style="text-align: right;">40</th>
<th style="text-align: right;">41</th>
<th style="text-align: right;">42</th>
<th style="text-align: right;">43</th>
<th style="text-align: right;">44</th>
<th style="text-align: right;">45</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">43</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">37</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">46</th>
<th style="text-align: right;">47</th>
<th style="text-align: right;">48</th>
<th style="text-align: right;">49</th>
<th style="text-align: right;">50</th>
<th style="text-align: right;">51</th>
<th style="text-align: right;">52</th>
<th style="text-align: right;">53</th>
<th style="text-align: right;">54</th>
<th style="text-align: right;">55</th>
<th style="text-align: right;">56</th>
<th style="text-align: right;">57</th>
<th style="text-align: right;">58</th>
<th style="text-align: right;">59</th>
<th style="text-align: right;">60</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">42</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">35</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">61</th>
<th style="text-align: right;">62</th>
<th style="text-align: right;">63</th>
<th style="text-align: right;">64</th>
<th style="text-align: right;">65</th>
<th style="text-align: right;">66</th>
<th style="text-align: right;">67</th>
<th style="text-align: right;">68</th>
<th style="text-align: right;">69</th>
<th style="text-align: right;">70</th>
<th style="text-align: right;">71</th>
<th style="text-align: right;">72</th>
<th style="text-align: right;">73</th>
<th style="text-align: right;">74</th>
<th style="text-align: right;">75</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">38</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">26</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">76</th>
<th style="text-align: right;">77</th>
<th style="text-align: right;">78</th>
<th style="text-align: right;">79</th>
<th style="text-align: right;">80</th>
<th style="text-align: right;">81</th>
<th style="text-align: right;">82</th>
<th style="text-align: right;">83</th>
<th style="text-align: right;">84</th>
<th style="text-align: right;">85</th>
<th style="text-align: right;">86</th>
<th style="text-align: right;">87</th>
<th style="text-align: right;">88</th>
<th style="text-align: right;">89</th>
<th style="text-align: right;">90</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">27</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">29</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>In totale sono state effettuate <span class="math inline">n</span> = 3171 estrazioni. Ad un occhio poco esperto, potrebbe sembrare che i numeri 15 ed 80 compaiano con maggiore frequenza rispetto agli altri (51 volte e 50 volte, rispettivamente). È anche ironico notare che non si tratta dei numeri (21 e 48) usati nella famosa scommessa – non saprei proprio dire quale criterio abbiano seguito i tre studenti salentini. In ogni caso, si tratta di <span class="orange">oscillazioni casuali</span>, come vedremo.</p>
<p>Possiamo anche rappresentare graficamente queste frequenze, ottenendo il seguente <a href="https://tommasorigon.github.io/StatI/slides/sl_G.pdf">diagramma a bastoncini</a>.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lotteria_truccata_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="3000"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p>La tabella ed il grafico confermano che ci sono delle oscillazioni nelle frequenze: alcuni numeri sono comparsi di più, altri di meno. Questo è un fenomeno assolutamente normale!</p>
</div>
</div>
</div>
</section>
<section id="oscillazioni-casuali-o-lotteria-difettosa" class="level2">
<h2 class="anchored" data-anchor-id="oscillazioni-casuali-o-lotteria-difettosa">Oscillazioni casuali o lotteria difettosa?</h2>
<p>Per stabilire se le oscillazioni che abbiamo registrato sono frutto del caso o meno, dobbiamo usare degli <span class="orange">strumenti statistici</span> un po’ più complicati. Sotto l’ipotesi di indipendenza delle estrazioni, ma non quella di equidistribuzione, la frequenze che abbiano riportato sopra, che indichiamo con <span class="math inline">n_1,\dots,n_{90}</span>, seguono una <span class="blue">distribuzione multinomiale</span> di parametro <span class="math inline">n</span> = 3171 e probabilità <span class="math inline">p_1,\dots,p_{90}</span>.</p>
<p>Vogliamo verificare se le probabilità <span class="math inline">p_1,\dots,p_{90}</span> sono diverse tra loro, cosa che indicherebbe la presenza di un macchinario “difettoso”, oppure se sono uguali tra loro e pari a <span class="math inline">1/90</span>. Per far questo, facciamo uso del celeberrimo <span class="orange">test del Chi-quadrato</span><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. In pratica, confrontiamo le frequenze che abbiamo osservato <span class="math inline">n_1,\dots,n_{90}</span> con quelle “teoriche”, pari a <span class="math inline">n_\text{teo} = n / 90 = 35.233</span>. Otteniamo: <span class="math display">
X^2 = \frac{(n_1 - n_\text{teo})^2 + \cdots + (n_{90} - n_\text{teo})^2}{n_\text{teo}} = 102.12.
</span> Il numero <span class="math inline">X^2</span> = 102.12 va confrontato con i valori che ci aspetteremmo di osservare se la lotteria fosse regolare, che sono compresi tra circa 65 e 117. Più rigorosamente, calcoliamo il cosiddetto <span class="blue">p-value</span>, un concetto tecnico un po’ difficile da raccontare, ma che in buona sostanza ci conferma che <span class="orange">non ci sono anomalie statistiche</span>. Per gli statistici in ascolto, ecco i risultati completi:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
    Chi-squared test for given probabilities

data:  freq
X-squared = 102.12, df = 89, p-value = 0.1615</code></pre>
</div>
</div>
</section>
<section id="un-cenno-a-metodi-statistici-più-complessi" class="level2">
<h2 class="anchored" data-anchor-id="un-cenno-a-metodi-statistici-più-complessi">Un cenno a metodi statistici più complessi</h2>
<div class="callout callout-style-simple callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
E gli altri numeri?
</div>
</div>
<div class="callout-body-container callout-body">
<p>In effetti, i numeri della lotteria sono 5 mentre noi abbiamo analizzato soltanto il primo (<code>N1</code>). Ho pertanto eseguito la stessa analisi per tutti i numeri <code>N1</code>, <code>N2</code>, <code>N3</code>, <code>N4</code> ed <code>N5</code>, applicando una correzione di Bonferroni, senza registrare alcuna anomalia. A dirla tutta, nessun p-value risultava inferiore a <span class="math inline">0.1</span>, rendendo superflua la correzione di Bonferroni.</p>
<p>Ancor meglio, si potrebbe modellare la distribuzione congiunta dei <span class="math inline">5</span> numeri della lotteria e confrontarla quindi con una distribuzione ipergeometrica multivariata. Questra strada è forse la migliore ed è anche tecnicamente percorribile, ma richiede un po’ troppo lavoro aggiuntivo che mi sembrava eccessivo ai fini di questo post.</p>
</div>
</div>
<div class="callout callout-style-simple callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
E l’ipotesi di indipendenza?
</div>
</div>
<div class="callout-body-container callout-body">
<p>In questa analisi abbiamo fatto uso dell’ipotesi di indipendenza tra le diverse estrazioni. È un’ipotesi molto ragionevole, perchè l’unico modo per violarla è tramite una <span class="blue">frode</span>.</p>
<p>In linea di principio, anche l’ipotesi di indipendenza può essere messa sotto attento scrutinio statistico, al costo di un po’ di lavoro aggiuntivo. Mi sembra, però, che l’accusa di frode allo stato italiano sfoci nel <span class="blue">complottismo</span>, soprattutto se non supportata da ulteriori prove indiziali di altra natura.</p>
</div>
</div>
<section id="un-aggiornamento-ed-unelegante-soluzione" class="level4">
<h4 class="anchored" data-anchor-id="un-aggiornamento-ed-unelegante-soluzione">Un aggiornamento ed un’elegante soluzione</h4>
<p>Proprio nel paragrafo precedente, ho accennato alla possibilità di modellare la distribuzione congiunta dei <span class="math inline">5</span> numeri della lotteria e confrontarla con una distribuzione ipergeometrica multivariata. L’approccio è corretto ma un po’ complicato. Fortunamente, esiste una <span class="blue">elegante soluzione</span> che consente di semplificare notevolmente il problema.</p>
<p>Nell’articolo Stigler (2003), che quando ho scritto questo post non avevo letto, si fa riferimento ad un test del chi-quadrato simile a quello che ho eseguito qui sopra. Stigler considera le frequenze <span class="math inline">N_1,\dots, N_{90}</span> di <span class="orange">tutti e 5 i numeri della lotteria</span> e considera quindi una correzione di <span class="math inline">X^2</span> che tenga conto del fatto che le cinquine sono state estratte senza reinserimento. Stigler, a sua volta, rimanda all’autorevole libro <span class="blue">McCullagh &amp; Nelder</span> (1986, pag. 191-192), in cui è dato come esercizio (!).</p>
<p>In questo caso, avremo che <span class="math inline">N</span> = 15855 e che <span class="math inline">N_\text{teo} = N / 90 = 176.167</span>. Il test del chi-quadrato, aggiustato per tener conto dei reinserimenti, è <span class="math display">
(X^2 \text{ corretto}) = \frac{89}{85}X^2 = \frac{89}{85}\frac{(N_1 - N_\text{teo})^2 + \cdots + (N_{90} - N_\text{teo})^2}{N_\text{teo}} = 87.33.
</span> I risultati completi sono riportati nel seguito, incluso il p-value, che nuovamente <span class="orange">non mostra alcuna evidenza</span> di uno <span class="orange">sbilanciamento della lotteria</span>.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: right;"><span class="math inline">X^2</span></th>
<th style="text-align: right;"><span class="math inline">X^2</span> corretto</th>
<th style="text-align: right;">Gradi di libertà</th>
<th style="text-align: right;">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">83.40114</td>
<td style="text-align: right;">87.32589</td>
<td style="text-align: right;">89</td>
<td style="text-align: right;">0.5303704</td>
</tr>
</tbody>
</table>
<p>L’articolo di Stigler inoltre menziona anche a test utili a verificare l’ipotesi di indipendenza delle estrazioni, che tuttavia qui non approfondiremo.</p>


</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Note</h2>

<ol>
<li id="fn1"><p>Questo bell’articolo mi è stato segnalato dal prof. Aldo Solari, che ha letto una versione iniziale di questo post e che ringrazio molto.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Il <a href="https://it.wikipedia.org/wiki/Test_chi_quadrato">test del chi-quadrato</a> è un famoso test statistico introdotto da Karl Pearson all’inizio del secolo scorso. Una trattazione più dettagliata si può trovare in Sezione 1.5.2 del libro <a href="https://www.amazon.it/Categorical-Data-Analysis-Alan-Agresti/dp/0470463635">Agresti (2013)</a>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiato!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiato!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>